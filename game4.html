<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Champions ‚Äî ChampsDual</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
<script src="/socket.io/socket.io.js"></script>
<style>
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
  :root{--gold:#C8AA6E;--gold-light:#F0E6D3;--gold-dark:#785A28;--deep:#010A13;--correct:#2ecc71;--wrong:#e74c3c;--almost:#f39c12;}

  /* ‚îÄ‚îÄ Bloquer toute s√©lection sauf dans les inputs ‚îÄ‚îÄ */
  body{background:var(--deep);color:var(--gold-light);font-family:'Cinzel',serif;min-height:100vh;overflow-x:hidden;
       -webkit-user-select:none;-moz-user-select:none;user-select:none;}
  input{-webkit-user-select:text;-moz-user-select:text;user-select:text;}
  img{-webkit-user-drag:none;user-drag:none;pointer-events:none;}

  .bg-layer{position:fixed;inset:0;z-index:0;}
  .bg-gradient{background:radial-gradient(ellipse 80% 50% at 50% 0%,#0d1f3c 0%,transparent 60%),var(--deep);}
  .bg-hexgrid{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='70'%3E%3Cpolygon points='30,2 58,17 58,52 30,67 2,52 2,17' fill='none' stroke='%23C8AA6E' stroke-width='0.3' opacity='0.08'/%3E%3C/svg%3E");background-size:60px 70px;}
  .corner{position:fixed;width:80px;height:80px;z-index:2;opacity:.4;}
  .corner-tl{top:0;left:0;border-top:2px solid var(--gold);border-left:2px solid var(--gold);}
  .corner-tr{top:0;right:0;border-top:2px solid var(--gold);border-right:2px solid var(--gold);}
  .corner-bl{bottom:0;left:0;border-bottom:2px solid var(--gold);border-left:2px solid var(--gold);}
  .corner-br{bottom:0;right:0;border-bottom:2px solid var(--gold);border-right:2px solid var(--gold);}

  .screen{position:relative;z-index:10;display:none;}
  .screen.active{display:flex;flex-direction:column;}

  /* ‚ïê‚ïê SETUP ‚ïê‚ïê */
  #setup-screen{min-height:100vh;align-items:center;justify-content:center;padding:2rem;}
  .setup-box{border:1px solid var(--gold-dark);padding:2.5rem;background:linear-gradient(135deg,#0a1628,#010a13);position:relative;max-width:520px;width:100%;text-align:center;}
  .setup-box::before{content:'';position:absolute;top:-2px;left:-2px;width:25px;height:25px;border:2px solid var(--gold);border-right:none;border-bottom:none;}
  .setup-box::after{content:'';position:absolute;bottom:-2px;right:-2px;width:25px;height:25px;border:2px solid var(--gold);border-left:none;border-top:none;}
  .setup-icon{font-size:2.5rem;margin-bottom:.75rem;}
  .setup-title{font-family:'Cinzel Decorative',serif;font-size:1.3rem;background:linear-gradient(180deg,#F0E6D3 0%,#C8AA6E 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:.4rem;}
  .setup-sub{font-size:.58rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold);opacity:.5;margin-bottom:2rem;}
  .steps{text-align:left;display:flex;flex-direction:column;gap:.6rem;margin-bottom:2rem;}
  .step{display:flex;gap:.75rem;}
  .step-num{font-family:'Cinzel Decorative',serif;font-size:.9rem;color:var(--gold);min-width:1.4rem;}
  .step-text{font-size:.66rem;line-height:1.7;color:var(--gold-light);opacity:.75;}
  .step-text a{color:var(--gold);text-decoration:none;border-bottom:1px solid rgba(200,170,110,.3);}
  .step-text code{background:rgba(200,170,110,.1);padding:.1rem .3rem;font-family:monospace;font-size:.75rem;border-radius:2px;}

  /* ‚ïê‚ïê LOBBY ‚ïê‚ïê */
  #lobby-screen{min-height:100vh;align-items:center;justify-content:center;padding:2rem;}
  .lobby-header{text-align:center;margin-bottom:2.5rem;animation:fadeUp .6s ease forwards;opacity:0;}
  .lobby-icon{font-size:2.8rem;margin-bottom:.6rem;}
  .lobby-title{font-family:'Cinzel Decorative',serif;font-size:clamp(1.4rem,4vw,2.2rem);background:linear-gradient(180deg,#F0E6D3 0%,#C8AA6E 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:.35rem;}
  .lobby-sub{font-size:.58rem;letter-spacing:.4em;text-transform:uppercase;color:var(--gold);opacity:.5;}
  .lobby-cards{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;width:min(740px,92vw);animation:fadeUp .6s ease forwards .2s;opacity:0;}
  @media(max-width:560px){.lobby-cards{grid-template-columns:1fr;}}
  .mode-card{position:relative;background:linear-gradient(160deg,rgba(15,30,55,.9),rgba(5,12,25,.95));border:1px solid var(--gold-dark);padding:2rem 1.75rem 1.75rem;display:flex;flex-direction:column;gap:.9rem;transition:transform .25s,border-color .25s,box-shadow .25s;}
  .mode-card::before,.mode-card::after{content:'';position:absolute;width:18px;height:18px;border-color:var(--gold);border-style:solid;}
  .mode-card::before{top:-1px;left:-1px;border-width:2px 0 0 2px;}
  .mode-card::after{bottom:-1px;right:-1px;border-width:0 2px 2px 0;}
  .mode-card:hover{transform:translateY(-4px);border-color:var(--gold);box-shadow:0 0 25px rgba(200,170,110,.1),0 15px 35px rgba(0,0,0,.4);}
  .mode-card-num{font-family:'Cinzel Decorative',serif;font-size:2rem;color:rgba(200,170,110,.07);position:absolute;top:.75rem;right:.9rem;}
  .mode-card-icon{font-size:2rem;}
  .mode-card-name{font-family:'Cinzel Decorative',serif;font-size:clamp(.9rem,2vw,1.1rem);background:linear-gradient(135deg,#F0E6D3 0%,#C8AA6E 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
  .mode-card-desc{font-size:.65rem;line-height:1.75;color:var(--gold-light);opacity:.55;}
  .room-form{display:flex;flex-direction:column;gap:.55rem;margin-top:auto;}
  .room-divider{display:flex;align-items:center;gap:.5rem;margin:.2rem 0;}
  .room-divider-line{flex:1;height:1px;background:rgba(200,170,110,.12);}
  .room-divider-text{font-size:.44rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold);opacity:.4;}
  .server-status{display:inline-flex;align-items:center;gap:.4rem;font-size:.5rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);opacity:.6;}
  .sdot{width:6px;height:6px;border-radius:50%;}
  .sdot.connected{background:var(--correct);box-shadow:0 0 4px var(--correct);}
  .sdot.disconnected{background:var(--wrong);}
  .sdot.connecting{background:var(--almost);animation:blink 1s infinite;}
  @keyframes blink{0%,100%{opacity:1;}50%{opacity:.3;}}
  .lobby-footer{display:flex;align-items:center;justify-content:space-between;width:min(740px,92vw);margin-top:1.5rem;animation:fadeUp .5s ease forwards .35s;opacity:0;}
  .back-link{font-size:.55rem;letter-spacing:.22em;text-transform:uppercase;color:var(--gold);opacity:.45;text-decoration:none;transition:opacity .2s;}
  .back-link:hover{opacity:.9;}
  .reconfig-btn{font-size:.5rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);opacity:.3;background:none;border:none;cursor:pointer;font-family:'Cinzel',serif;transition:opacity .2s;}
  .reconfig-btn:hover{opacity:.8;}

  /* ‚îÄ‚îÄ Shared inputs/btns ‚îÄ‚îÄ */
  .field-label{font-size:.5rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold);opacity:.55;display:block;margin-bottom:.4rem;}
  .text-input{width:100%;padding:.72rem 1rem;background:rgba(10,22,40,.9);border:1px solid var(--gold-dark);color:var(--gold-light);font-family:'Cinzel',serif;font-size:.82rem;letter-spacing:.08em;outline:none;transition:border-color .2s;-webkit-user-select:text;user-select:text;}
  .text-input:focus{border-color:var(--gold);}
  .text-input::placeholder{color:rgba(200,170,110,.28);}
  .gold-btn{position:relative;display:inline-flex;align-items:center;justify-content:center;width:100%;padding:.88rem;background:transparent;border:none;cursor:pointer;font-family:'Cinzel',serif;font-size:.78rem;font-weight:600;letter-spacing:.25em;text-transform:uppercase;color:var(--deep);clip-path:polygon(10px 0%,calc(100% - 10px) 0%,100% 50%,calc(100% - 10px) 100%,10px 100%,0% 50%);transition:transform .2s,filter .2s;margin-top:.75rem;}
  .gold-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,#F0E6D3 0%,#C8AA6E 50%,#A17D3A 100%);z-index:-1;}
  .gold-btn:hover{transform:scale(1.02);filter:brightness(1.1);}
  .ghost-btn{display:inline-flex;align-items:center;justify-content:center;width:100%;padding:.75rem;background:transparent;border:1px solid var(--gold-dark);cursor:pointer;font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);transition:border-color .2s,background .2s;margin-top:.5rem;}
  .ghost-btn:hover{border-color:var(--gold);background:rgba(200,170,110,.06);}
  .error-msg{font-size:.62rem;color:var(--wrong);min-height:1.2rem;margin-top:.5rem;letter-spacing:.05em;}
  .skip-link{font-size:.52rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);opacity:.35;background:none;border:none;cursor:pointer;font-family:'Cinzel',serif;transition:opacity .2s;display:block;margin-top:1rem;}
  .skip-link:hover{opacity:.85;}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}

  /* ‚ïê‚ïê GAME HEADER ‚ïê‚ïê */
  #game-screen{min-height:100vh;align-items:stretch;}
  .game-header{position:sticky;top:0;z-index:20;width:100%;background:rgba(1,10,19,.96);backdrop-filter:blur(10px);border-bottom:1px solid rgba(200,170,110,.18);padding:.6rem 1.25rem;display:flex;align-items:center;gap:.75rem;height:58px;}
  .hdr-left{display:flex;align-items:center;gap:.75rem;flex-shrink:0;}
  .hdr-mid{flex:1;min-width:0;max-width:460px;}
  .hdr-right{margin-left:auto;display:flex;align-items:center;gap:.9rem;flex-shrink:0;}

  /* ‚îÄ‚îÄ ChampsDual nav ‚îÄ‚îÄ */
  .nav-home{position:relative;display:inline-flex;align-items:center;gap:.25rem;font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);text-decoration:none;white-space:nowrap;opacity:.75;transition:opacity .2s;padding:.25rem 0;cursor:pointer;}
  .nav-home:hover{opacity:1;}
  .nav-arrow{font-size:.4rem;transition:transform .2s;}
  .nav-home:hover .nav-arrow{transform:rotate(180deg);}
  .nav-dropdown{position:absolute;top:calc(100% + 8px);left:0;min-width:170px;background:rgba(4,12,26,.98);border:1px solid var(--gold-dark);flex-direction:column;z-index:100;display:none;}
  .nav-home:hover .nav-dropdown,.nav-dropdown:hover{display:flex;}
  .nav-item{display:block;padding:.52rem .9rem;font-size:.58rem;letter-spacing:.12em;text-transform:uppercase;color:var(--gold-light);text-decoration:none;opacity:.6;transition:background .15s,opacity .15s;border-bottom:1px solid rgba(200,170,110,.06);white-space:nowrap;}
  .nav-item:last-child{border-bottom:none;}
  .nav-item:hover{background:rgba(200,170,110,.1);opacity:1;}
  .nav-sep{height:1px;background:rgba(200,170,110,.15);}

  /* ‚îÄ‚îÄ Room badge ‚îÄ‚îÄ */
  .room-badge{display:flex;align-items:center;gap:.4rem;border:1px solid var(--gold-dark);padding:.25rem .55rem;cursor:pointer;transition:border-color .2s;background:rgba(10,22,40,.6);}
  .room-badge:hover{border-color:var(--gold);}
  .room-badge-lbl{font-size:.38rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold);opacity:.5;}
  .room-badge-code{font-size:.75rem;letter-spacing:.2em;color:var(--gold);font-family:'Cinzel Decorative',serif;}
  .room-badge.hidden{display:none;}

  /* ‚îÄ‚îÄ Input bar ‚îÄ‚îÄ */
  .input-bar{display:flex;gap:.4rem;}
  .champ-input{flex:1;padding:.45rem .8rem;background:rgba(10,22,40,.9);border:1px solid var(--gold-dark);color:var(--gold-light);font-family:'Cinzel',serif;font-size:.8rem;letter-spacing:.06em;outline:none;transition:border-color .3s,box-shadow .3s;min-width:0;-webkit-user-select:text;user-select:text;}
  .champ-input:focus{border-color:var(--gold);}
  .champ-input::placeholder{color:rgba(200,170,110,.28);}
  .champ-input.fc{border-color:var(--correct)!important;box-shadow:0 0 10px rgba(46,204,113,.35);}
  .champ-input.fw{border-color:var(--wrong)!important;box-shadow:0 0 8px rgba(231,76,60,.25);}
  .mini-sub{padding:.45rem .85rem;background:transparent;border:1px solid var(--gold-dark);color:var(--gold);font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.18em;text-transform:uppercase;cursor:pointer;white-space:nowrap;transition:border-color .2s,background .2s;}
  .mini-sub:hover{border-color:var(--gold);background:rgba(200,170,110,.07);}

  /* ‚îÄ‚îÄ Hstats ‚îÄ‚îÄ */
  .hstat{text-align:center;}
  .hstat-lbl{font-size:.38rem;letter-spacing:.28em;text-transform:uppercase;color:var(--gold);opacity:.5;display:block;}
  .hstat-val{font-size:.95rem;color:var(--gold-light);font-weight:600;font-family:'Cinzel Decorative',serif;}
  .timer-disp{font-family:'Cinzel Decorative',serif;font-size:1.2rem;background:linear-gradient(180deg,#F0E6D3 0%,#C8AA6E 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 6px rgba(200,170,110,.4));}

  /* ‚îÄ‚îÄ Players dropdown vertical ‚îÄ‚îÄ */
  .players-wrap{position:relative;display:flex;align-items:center;cursor:default;}
  .players-summary{display:flex;align-items:center;gap:.35rem;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--gold);opacity:.7;white-space:nowrap;}
  .pip-dots{display:flex;gap:3px;align-items:center;}
  .pipdot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
  .pipdot.me{background:var(--gold);}
  .pipdot.other{background:var(--correct);animation:blink 2s infinite;}
  .players-panel{position:absolute;top:calc(100% + 8px);right:0;min-width:170px;background:rgba(4,12,26,.98);border:1px solid var(--gold-dark);flex-direction:column;z-index:50;display:none;padding:.3rem 0;}
  .players-wrap:hover .players-panel{display:flex;}
  .p-row{display:flex;align-items:center;gap:.5rem;padding:.38rem .75rem;white-space:nowrap;}
  .p-name{font-size:.6rem;letter-spacing:.06em;color:var(--gold-light);opacity:.85;flex:1;}
  .p-score{font-family:'Cinzel Decorative',serif;font-size:.65rem;color:var(--gold);opacity:.7;}

  /* ‚ïê‚ïê GAME BODY ‚ïê‚ïê */
  .game-body{position:relative;z-index:10;display:flex;flex:1;}
  .feed-sidebar{width:205px;min-width:205px;border-right:1px solid rgba(200,170,110,.1);background:rgba(1,10,19,.5);display:flex;flex-direction:column;max-height:calc(100vh - 58px);position:sticky;top:58px;align-self:flex-start;}
  .feed-title{font-size:.45rem;letter-spacing:.33em;text-transform:uppercase;color:var(--gold);opacity:.5;padding:.55rem 1rem;border-bottom:1px solid rgba(200,170,110,.08);}
  .feed-list{flex:1;overflow-y:auto;padding:.3rem;}
  .feed-list::-webkit-scrollbar{width:3px;}
  .feed-list::-webkit-scrollbar-thumb{background:var(--gold-dark);}
  .fi{display:flex;align-items:center;gap:.4rem;padding:.26rem .38rem;animation:feedIn .3s ease;margin-bottom:.12rem;}
  @keyframes feedIn{from{opacity:0;transform:translateX(-8px);}to{opacity:1;}}
  .fi-img{width:26px;height:26px;border-radius:50%;border:1px solid var(--gold-dark);object-fit:cover;flex-shrink:0;}
  .fi-txt{font-size:.53rem;line-height:1.4;color:var(--gold-light);opacity:.8;min-width:0;overflow:hidden;}
  .fi-player{color:var(--gold);font-weight:600;}
  .fi-time{font-size:.44rem;color:var(--gold);opacity:.4;margin-left:auto;white-space:nowrap;}
  .grid-area{flex:1;padding:1.1rem;overflow-y:auto;}
  .prog-row{display:flex;align-items:center;gap:1rem;margin-bottom:1.1rem;}
  .prog-bg{flex:1;height:3px;background:rgba(200,170,110,.12);}
  .prog-fill{height:100%;background:linear-gradient(to right,var(--gold-dark),var(--gold));transition:width .5s ease;}
  .prog-txt{font-size:.5rem;letter-spacing:.26em;text-transform:uppercase;color:var(--gold);opacity:.55;white-space:nowrap;}

  /* ‚îÄ‚îÄ Champion tiles ‚Äî selection totalement bloqu√©e ‚îÄ‚îÄ */
  .champ-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(66px,1fr));gap:.5rem;}
  .ctile{position:relative;aspect-ratio:1;border:1px solid rgba(200,170,110,.17);background:rgba(8,18,32,.85);overflow:hidden;transition:border-color .3s;-webkit-user-select:none;user-select:none;cursor:default;}
  .ctile *{-webkit-user-select:none;user-select:none;pointer-events:none;}
  .ctile img{width:100%;height:100%;object-fit:cover;display:block;opacity:0;transition:opacity .4s;-webkit-user-drag:none;}
  .ctile.found img{opacity:1;}
  .ctile-ov{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(1,10,19,.8);transition:opacity .4s;}
  .ctile.found .ctile-ov{opacity:0;}
  .ctile-q{font-family:'Cinzel Decorative',serif;font-size:1.2rem;color:rgba(200,170,110,.2);}
  .ctile-name{position:absolute;bottom:0;left:0;right:0;font-size:.35rem;letter-spacing:.04em;text-align:center;padding:.15rem .1rem;background:rgba(1,10,19,.88);color:var(--gold);opacity:0;transition:opacity .3s;text-transform:uppercase;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .ctile.found .ctile-name{opacity:1;}
  .ctile-finder{position:absolute;top:2px;left:0;right:0;font-size:.32rem;text-align:center;background:rgba(1,10,19,.72);padding:1px;color:var(--gold-light);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0;transition:opacity .3s;}
  .ctile.found .ctile-finder{opacity:.7;}
  .ctile.found{border-color:rgba(200,170,110,.5);animation:tileReveal .45s ease;}
  .ctile.found.byme{border-color:var(--correct);}
  .ctile-finder.byme{color:var(--correct);}
  @keyframes tileReveal{0%{transform:scale(.78);filter:brightness(2.5);}100%{transform:scale(1);filter:brightness(1);}}

  /* ‚ïê‚ïê REVEAL MODAL ‚Äî shown after correct answer ‚ïê‚ïê */
  .reveal-modal{position:fixed;inset:0;z-index:40;display:flex;align-items:center;justify-content:center;background:rgba(1,10,19,.82);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .25s;}
  .reveal-modal.show{opacity:1;pointer-events:all;}
  .reveal-card{position:relative;border:1px solid var(--gold-dark);background:linear-gradient(160deg,#0c1e3a,#010a13);padding:0;overflow:hidden;width:min(320px,88vw);animation:revealIn .3s ease;}
  @keyframes revealIn{from{transform:scale(.88);opacity:0;}to{transform:scale(1);opacity:1;}}
  .reveal-card::before{content:'';position:absolute;top:-2px;left:-2px;width:22px;height:22px;border:2px solid var(--gold);border-right:none;border-bottom:none;z-index:2;}
  .reveal-card::after{content:'';position:absolute;bottom:-2px;right:-2px;width:22px;height:22px;border:2px solid var(--gold);border-left:none;border-top:none;z-index:2;}
  .reveal-img-wrap{width:100%;aspect-ratio:1;overflow:hidden;position:relative;}
  .reveal-img{width:100%;height:100%;object-fit:cover;display:block;pointer-events:none;-webkit-user-drag:none;}
  .reveal-found-by{position:absolute;top:8px;right:8px;font-size:.45rem;letter-spacing:.15em;text-transform:uppercase;background:rgba(46,204,113,.85);color:#000;padding:.2rem .5rem;font-family:'Cinzel',serif;}
  .reveal-info{padding:.9rem 1.1rem 1rem;}
  .reveal-name{font-family:'Cinzel Decorative',serif;font-size:1.2rem;background:linear-gradient(135deg,#F0E6D3 0%,#C8AA6E 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:.8rem;}
  .reveal-hint{font-size:.5rem;letter-spacing:.25em;text-transform:uppercase;color:var(--gold);opacity:.4;margin-top:.6rem;}

  /* Victory */
  .victory{position:fixed;inset:0;z-index:50;background:rgba(1,10,19,.97);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .5s;}
  .victory.show{opacity:1;pointer-events:all;}
  .vic-box{text-align:center;border:1px solid var(--gold-dark);padding:2.5rem 3.5rem;background:linear-gradient(135deg,#0a1628,#010a13);position:relative;max-width:500px;width:90%;}
  .vic-box::before{content:'';position:absolute;top:-2px;left:-2px;width:25px;height:25px;border:2px solid var(--gold);border-right:none;border-bottom:none;}
  .vic-box::after{content:'';position:absolute;bottom:-2px;right:-2px;width:25px;height:25px;border:2px solid var(--gold);border-left:none;border-top:none;}
  .vic-title{font-family:'Cinzel Decorative',serif;font-size:1.8rem;background:linear-gradient(180deg,#F0E6D3 0%,#C8AA6E 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:.4rem;}
  .vic-sub{font-size:.58rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold);opacity:.55;margin-bottom:1.5rem;}
  .vic-time{font-family:'Cinzel Decorative',serif;font-size:2.5rem;color:var(--gold);filter:drop-shadow(0 0 12px rgba(200,170,110,.6));margin-bottom:.3rem;}
  .vic-lbl{font-size:.55rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold);opacity:.45;margin-bottom:1.5rem;}
  .scores{border:1px solid var(--gold-dark);padding:.75rem 1rem;margin-bottom:1.5rem;text-align:left;}
  .sc-row{display:flex;justify-content:space-between;align-items:center;padding:.25rem 0;border-bottom:1px solid rgba(200,170,110,.07);}
  .sc-row:last-child{border-bottom:none;}
  .sc-name{font-size:.68rem;color:var(--gold-light);}
  .sc-pts{font-size:.85rem;font-family:'Cinzel Decorative',serif;color:var(--gold);}

  .loading{position:fixed;inset:0;z-index:60;background:var(--deep);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem;transition:opacity .5s;}
  .loading.hidden{opacity:0;pointer-events:none;}
  .loading-title{font-family:'Cinzel Decorative',serif;font-size:1.5rem;background:linear-gradient(180deg,#F0E6D3 0%,#C8AA6E 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
  .loading-bar-wrap{width:200px;height:2px;background:rgba(200,170,110,.2);overflow:hidden;}
  .loading-bar{width:100%;height:100%;background:linear-gradient(to right,transparent,var(--gold),transparent);animation:scan 1.2s ease-in-out infinite;}
  @keyframes scan{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
  .loading-text{font-size:.6rem;letter-spacing:.3em;color:var(--gold);opacity:.5;text-transform:uppercase;}
  .toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);z-index:40;background:rgba(8,20,40,.96);border:1px solid var(--gold-dark);padding:.55rem 1.5rem;font-size:.68rem;letter-spacing:.1em;color:var(--gold-light);text-align:center;transition:transform .3s,opacity .3s;opacity:0;max-width:90vw;}
  .toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
  @media(max-width:680px){.feed-sidebar{display:none;}.champ-grid{grid-template-columns:repeat(auto-fill,minmax(52px,1fr));}}
</style>
</head>
<body>
<div class="bg-layer bg-gradient"></div>
<div class="bg-layer bg-hexgrid"></div>
<div class="corner corner-tl"></div><div class="corner corner-tr"></div>
<div class="corner corner-bl"></div><div class="corner corner-br"></div>

<div class="loading" id="loading">
  <div class="loading-title">Convocation...</div>
  <div class="loading-bar-wrap"><div class="loading-bar"></div></div>
  <div class="loading-text" id="loading-text">Chargement des champions</div>
</div>
<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê REVEAL MODAL ‚ïê‚ïê -->
<div class="reveal-modal" id="reveal-modal">
  <div class="reveal-card" id="reveal-card">
    <div class="reveal-img-wrap">
      <img class="reveal-img" id="reveal-img" src="" alt="">
      <div class="reveal-found-by" id="reveal-found-by"></div>
    </div>
    <div class="reveal-info">
      <div class="reveal-name" id="reveal-name"></div>
      <button class="gold-btn" style="margin-top:0;" onclick="closeReveal()">Continuer ‚Üí</button>
      <div class="reveal-hint">Entr√©e ou clic pour continuer</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê SETUP ‚ïê‚ïê -->
<div class="screen" id="setup-screen">
  <div class="setup-box">
    <div class="setup-icon">üöÇ</div>
    <div class="setup-title">Configurer le serveur</div>
    <div class="setup-sub">Railway + Socket.io</div>
    <div class="steps">
      <div class="step"><div class="step-num">1</div><div class="step-text">Cr√©ez un compte gratuit sur <a href="https://railway.app" target="_blank">railway.app</a></div></div>
      <div class="step"><div class="step-num">2</div><div class="step-text">D√©ployez le repo GitHub contenant <code>server.js</code> et <code>package.json</code></div></div>
      <div class="step"><div class="step-num">3</div><div class="step-text">Copiez l'URL publique <code>https://xxx.railway.app</code> ci-dessous</div></div>
    </div>
    <label class="field-label">URL du serveur Railway</label>
    <input class="text-input" id="server-url" type="text" placeholder="https://votre-projet.railway.app">
    <div class="error-msg" id="setup-error"></div>
    <button class="gold-btn" onclick="saveServerUrl()">‚ú¶ Connecter et continuer</button>
    <button class="skip-link" onclick="skipToLobby()">Passer ‚Äî solo uniquement</button>
  </div>
</div>

<!-- ‚ïê‚ïê LOBBY ‚ïê‚ïê -->
<div class="screen" id="lobby-screen">
  <div class="lobby-header">
    <div class="lobby-icon">‚öîÔ∏è</div>
    <div class="lobby-title">Champions</div>
    <div class="lobby-sub">Retrouvez tous les champions</div>
  </div>
  <div class="lobby-cards">
    <div class="mode-card">
      <div class="mode-card-num">I</div>
      <div class="mode-card-icon">üéØ</div>
      <div class="mode-card-name">Solo</div>
      <div class="mode-card-desc">Retrouvez seul le nom de tous les champions. Tol√©rance phon√©tique sur les fautes de frappe.</div>
      <button class="gold-btn" onclick="startSolo()" style="margin-top:auto;">‚ñ∂ Jouer seul</button>
    </div>
    <div class="mode-card">
      <div class="mode-card-num">II</div>
      <div class="mode-card-icon">üë•</div>
      <div class="mode-card-name">Multijoueur</div>
      <div class="mode-card-desc">Cr√©ez une salle et partagez le lien. Trouvez tous les champions ensemble en temps r√©el.</div>
      <div class="room-form">
        <div>
          <label class="field-label">Pseudo</label>
          <input class="text-input" id="player-name" type="text" maxlength="18">
        </div>
        <div class="server-status">
          <div class="sdot connecting" id="sdot"></div>
          <span id="stext">Connexion...</span>
        </div>
        <button class="gold-btn" onclick="createRoom()">‚ú¶ Cr√©er une salle</button>
        <div class="room-divider">
          <div class="room-divider-line"></div><div class="room-divider-text">ou rejoindre</div><div class="room-divider-line"></div>
        </div>
        <div>
          <label class="field-label">Code de salle</label>
          <input class="text-input" id="room-code-input" type="text" placeholder="XXXXXX" maxlength="6" style="text-transform:uppercase;letter-spacing:.35em;">
        </div>
        <button class="ghost-btn" onclick="joinRoom()">Rejoindre ‚Üí</button>
        <div class="error-msg" id="lobby-error"></div>
      </div>
    </div>
  </div>
  <div class="lobby-footer">
    <a class="back-link" href="index.html">‚Üê ChampsDual</a>
    <button class="reconfig-btn" onclick="showScreen('setup-screen')">‚öô Serveur</button>
  </div>
</div>

<!-- ‚ïê‚ïê GAME ‚ïê‚ïê -->
<div class="screen" id="game-screen">
  <div class="game-header">

    <div class="hdr-left">
      <!-- ChampsDual + dropdown -->
      <a class="nav-home" href="index.html">
        ChampsDual <span class="nav-arrow">‚ñº</span>
        <div class="nav-dropdown">
          <a class="nav-item" href="index.html">üè† Accueil</a>
          <div class="nav-sep"></div>
          <a class="nav-item" href="game.html">üå´Ô∏è Flou</a>
          <a class="nav-item" href="game2.html">‚è±Ô∏è Flou Chrono</a>
          <a class="nav-item" href="game3.html">üî≤ Partiel</a>
          <a class="nav-item" href="game4.html">‚öîÔ∏è Champions</a>
        </div>
      </a>
      <div class="room-badge hidden" id="room-badge" onclick="copyRoomLink()">
        <div>
          <div class="room-badge-lbl">Salle</div>
          <div class="room-badge-code" id="room-badge-code">‚Äî‚Äî</div>
        </div>
        <span style="font-size:.45rem;color:var(--gold);opacity:.4;margin-left:.3rem;">üìã</span>
      </div>
    </div>

    <div class="hdr-mid">
      <div class="input-bar">
        <input class="champ-input" id="champ-input" type="text"
               placeholder="Entrez un nom de champion..."
               autocomplete="off" autocorrect="off" spellcheck="false">
        <button class="mini-sub" onclick="submitAnswer()">Valider</button>
      </div>
    </div>

    <div class="hdr-right">
      <div class="hstat"><span class="hstat-lbl">Trouv√©s</span><span class="hstat-val" id="found-count">0</span></div>
      <div class="hstat"><span class="hstat-lbl">Total</span><span class="hstat-val" id="total-count">‚Äî</span></div>
      <div class="hstat"><span class="hstat-lbl">Chrono</span><span class="timer-disp" id="timer-disp">00:00</span></div>
      <!-- Players vertical hover list -->
      <div class="players-wrap" id="players-wrap" style="display:none;">
        <div class="players-summary">
          <div class="pip-dots" id="pip-dots"></div>
          <span id="pip-count" style="font-size:.5rem;color:var(--gold);opacity:.6;margin-left:.2rem;"></span>
        </div>
        <div class="players-panel" id="players-panel"></div>
      </div>
    </div>

  </div>

  <div class="game-body">
    <div class="feed-sidebar">
      <div class="feed-title">üèÜ D√©couvertes</div>
      <div class="feed-list" id="feed-list"></div>
    </div>
    <div class="grid-area">
      <div class="prog-row">
        <div class="prog-bg"><div class="prog-fill" id="prog-fill" style="width:0%"></div></div>
        <div class="prog-txt" id="prog-txt">0 / ‚Äî champions</div>
      </div>
      <div class="champ-grid" id="champ-grid"></div>
    </div>
  </div>
</div>

<div class="victory" id="victory">
  <div class="vic-box">
    <div class="vic-title">üéâ Victoire !</div>
    <div class="vic-sub">Tous les champions trouv√©s !</div>
    <div class="vic-time" id="vic-time">00:00</div>
    <div class="vic-lbl">temps total</div>
    <div class="scores" id="scores"></div>
    <button class="gold-btn" onclick="location.href='index.html'" style="margin-bottom:0">‚Üê ChampsDual</button>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BLOQUER S√âLECTION / COPIE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('selectstart', e => {
  if (!e.target.closest('input') && !e.target.closest('textarea') && !e.target.closest('a')) {
    e.preventDefault();
  }
});
document.addEventListener('copy', e => {
  if (!e.target.closest('input') && !e.target.closest('textarea')) {
    e.preventDefault();
  }
});
document.addEventListener('contextmenu', e => {
  if (e.target.closest('#champ-grid')) e.preventDefault();
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FUZZY / PHONETIC
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function levenshtein(a,b){
  const m=a.length,n=b.length;if(!m)return n;if(!n)return m;
  const row=Array.from({length:n+1},(_,i)=>i);
  for(let i=1;i<=m;i++){let p=row[0];row[0]=i;for(let j=1;j<=n;j++){const t=row[j];row[j]=a[i-1]===b[j-1]?p:1+Math.min(p,row[j],row[j-1]);p=t;}}
  return row[n];
}
function maxDist(l){if(l<=3)return 0;if(l<=5)return 1;if(l<=8)return 2;if(l<=12)return 3;return 4;}
function nb(s){return s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]/g,'');}
function np(s){let r=nb(s);r=r.replace(/ph/g,'f').replace(/ck/g,'k').replace(/(.)\1+/g,'$1').replace(/^h/,'').replace(/y/g,'i').replace(/w/g,'v').replace(/eau/g,'o').replace(/ai/g,'e').replace(/qu/g,'k');return r;}
function fuzzyMatch(input,champName){
  if(!input||input.length<2)return false;
  const ni=nb(input),nc=nb(champName);
  if(ni===nc)return 'exact';
  const d=levenshtein(ni,nc),mx=maxDist(Math.max(ni.length,nc.length));
  if(d<=mx)return 'fuzzy';
  const pi=np(input),pc=np(champName);
  if(pi===pc||levenshtein(pi,pc)<=maxDist(Math.max(pi.length,pc.length)))return 'fuzzy';
  if(levenshtein('h'+ni,nc)<=mx)return 'fuzzy';
  return false;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let version='', allChampions=[], champMap={};
let mode='solo', myName='', mySocketId='';
let roomCode='', startTime=0, timerIntvl=null, socket=null, serverUrl='';
let foundIds=new Set(), events=[], playersList=[];
const URL_KEY='lol-server-url';
let guestId='';

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GUEST PLACEHOLDER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function initGuest(){
  guestId='Guess'+String(Math.floor(10000+Math.random()*90000));
  document.getElementById('player-name').placeholder=guestId;
}
function getPlayerName(){
  const v=document.getElementById('player-name').value.trim();
  return v||guestId;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BOOT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(async function boot(){
  initGuest();
  try{
    const v=await fetch('https://ddragon.leagueoflegends.com/api/versions.json');
    version=(await v.json())[0];
    const r=await fetch(`https://ddragon.leagueoflegends.com/cdn/${version}/data/fr_FR/champion.json`);
    allChampions=Object.values((await r.json()).data).map(c=>({id:c.id,name:c.name})).sort((a,b)=>a.name.localeCompare(b.name));
    allChampions.forEach(c=>{champMap[c.id]=c;});
    hideLoading();
    const saved=localStorage.getItem(URL_KEY);
    const hash=location.hash.replace('#','').toUpperCase().trim();
    if(hash.length===6)document.getElementById('room-code-input').value=hash;
    if(saved){serverUrl=saved;document.getElementById('server-url').value=saved;connectSocket(saved);showScreen('lobby-screen');}
    else showScreen('setup-screen');
  }catch(e){document.getElementById('loading-text').textContent='Erreur r√©seau';}
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SOCKET
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function connectSocket(url){
  if(socket){socket.disconnect();socket=null;}
  setStatus('connecting');
  try{
    socket=io(url,{transports:['websocket','polling'],timeout:6000});
    socket.on('connect',()=>{mySocketId=socket.id;setStatus('connected');});
    socket.on('disconnect',()=>setStatus('disconnected'));
    socket.on('connect_error',()=>setStatus('disconnected'));
    socket.on('champFound',onRemoteFind);
    socket.on('playerJoined',d=>{playersList=d.players;renderPlayers();});
    socket.on('playerLeft',d=>{playersList=d.players;renderPlayers();});
  }catch(e){setStatus('disconnected');}
}
function setStatus(s){
  const dot=document.getElementById('sdot'),txt=document.getElementById('stext');
  if(!dot)return;
  dot.className='sdot '+s;
  txt.textContent=s==='connected'?'Connect√©':s==='connecting'?'Connexion...':'D√©connect√©';
}
function saveServerUrl(){
  const url=document.getElementById('server-url').value.trim().replace(/\/$/,'');
  if(!url.startsWith('http')){document.getElementById('setup-error').textContent='URL invalide';return;}
  document.getElementById('setup-error').textContent='';
  serverUrl=url;localStorage.setItem(URL_KEY,url);connectSocket(url);showScreen('lobby-screen');
}
function skipToLobby(){showScreen('lobby-screen');}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SOLO / MULTI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function startSolo(){mode='solo';myName='Vous';startTime=Date.now();resetState();launchGame();}

function createRoom(){
  if(!socket||!socket.connected){setErr('Serveur non connect√©');return;}
  myName=getPlayerName();setErr('');mode='multi';
  socket.emit('createRoom',{name:myName},res=>{
    if(!res.ok){setErr(res.error||'Erreur');return;}
    roomCode=res.code;startTime=res.startTime;location.hash=roomCode;resetState();launchGame();
  });
}
function joinRoom(){
  if(!socket||!socket.connected){setErr('Serveur non connect√©');return;}
  const code=document.getElementById('room-code-input').value.trim().toUpperCase();
  if(code.length!==6){setErr('Code invalide (6 caract√®res)');return;}
  myName=getPlayerName();setErr('');mode='multi';roomCode=code;
  socket.emit('joinRoom',{name:myName,code},res=>{
    if(!res.ok){setErr(res.error||'Salle introuvable');return;}
    roomCode=res.code;startTime=res.startTime;location.hash=roomCode;resetState();
    (res.found||[]).forEach(ev=>{if(!foundIds.has(ev.champId)){foundIds.add(ev.champId);events.push(ev);}});
    playersList=res.players||[];
    launchGame();
  });
}
function onRemoteFind(ev){
  if(foundIds.has(ev.champId))return;
  foundIds.add(ev.champId);events.push(ev);
  revealTile(ev.champId,ev.playerName,false);
  addFeedItem(ev);updateUI();
  playersList=ev.players||playersList;renderPlayers();
  if(foundIds.size===allChampions.length)setTimeout(showVictory,600);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LAUNCH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function resetState(){foundIds=new Set();events=[];playersList=[];}
function launchGame(){
  clearInterval(timerIntvl);
  buildGrid();
  events.forEach(ev=>revealTile(ev.champId,ev.playerName,ev.playerId===mySocketId));
  updateUI();
  document.getElementById('total-count').textContent=allChampions.length;
  if(mode==='multi'){
    document.getElementById('room-badge').classList.remove('hidden');
    document.getElementById('room-badge-code').textContent=roomCode;
    document.getElementById('players-wrap').style.display='flex';
  }else{
    document.getElementById('room-badge').classList.add('hidden');
    document.getElementById('players-wrap').style.display='none';
  }
  renderPlayers();
  showScreen('game-screen');
  timerIntvl=setInterval(tickTimer,1000);
  document.getElementById('champ-input').focus();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GRID
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildGrid(){
  const g=document.getElementById('champ-grid');g.innerHTML='';
  allChampions.forEach(ch=>{
    const tile=document.createElement('div');tile.className='ctile';tile.id=`t-${ch.id}`;
    const img=document.createElement('img');
    img.src=`https://ddragon.leagueoflegends.com/cdn/${version}/img/champion/${ch.id}.png`;
    img.alt='';img.loading='lazy';img.draggable=false;
    const ov=document.createElement('div');ov.className='ctile-ov';
    ov.innerHTML='<span class="ctile-q">?</span>';
    const nm=document.createElement('div');nm.className='ctile-name';nm.textContent=ch.name;
    const fi=document.createElement('div');fi.className='ctile-finder';fi.id=`f-${ch.id}`;
    tile.append(img,ov,nm,fi);g.appendChild(tile);
  });
}
function revealTile(id,finder,byme){
  const t=document.getElementById(`t-${id}`);
  if(!t||t.classList.contains('found'))return;
  t.classList.add('found');if(byme)t.classList.add('byme');
  const fi=document.getElementById(`f-${id}`);
  if(fi&&mode==='multi'){fi.textContent=finder;if(byme)fi.classList.add('byme');}
}
function addFeedItem(ev){
  const feed=document.getElementById('feed-list');
  const el=document.createElement('div');el.className='fi';
  const e=Math.floor((ev.ts-startTime)/1000);
  const t=`${String(Math.floor(e/60)).padStart(2,'0')}:${String(e%60).padStart(2,'0')}`;
  el.innerHTML=`<img class="fi-img" src="https://ddragon.leagueoflegends.com/cdn/${version}/img/champion/${ev.champId}.png" alt=""><div class="fi-txt">${mode==='multi'?`<span class="fi-player">${escH(ev.playerName)}</span><br>`:''}${escH(ev.champName)}</div><span class="fi-time">${t}</span>`;
  feed.insertBefore(el,feed.firstChild);
  while(feed.children.length>80)feed.removeChild(feed.lastChild);
}
function updateUI(){
  const n=foundIds.size,tot=allChampions.length;
  document.getElementById('found-count').textContent=n;
  document.getElementById('prog-fill').style.width=(n/tot*100)+'%';
  document.getElementById('prog-txt').textContent=`${n} / ${tot} champions`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PLAYERS ‚Äî liste verticale hover
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderPlayers(){
  const dots=document.getElementById('pip-dots');
  const count=document.getElementById('pip-count');
  const panel=document.getElementById('players-panel');
  if(!dots)return;
  dots.innerHTML='';panel.innerHTML='';
  if(mode!=='multi'||!playersList.length){count.textContent='';return;}

  playersList.forEach(p=>{
    const d=document.createElement('div');
    d.className='pipdot '+(p.id===mySocketId?'me':'other');
    dots.appendChild(d);
    const row=document.createElement('div');row.className='p-row';
    const pd=document.createElement('div');pd.className='pipdot '+(p.id===mySocketId?'me':'other');pd.style.flexShrink='0';
    const nm=document.createElement('span');nm.className='p-name';nm.textContent=p.name+(p.id===mySocketId?' ‚ú¶':'');
    const sc=document.createElement('span');sc.className='p-score';sc.textContent=p.score;
    row.append(pd,nm,sc);panel.appendChild(row);
  });
  count.textContent=playersList.length+'j';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ANSWER + REVEAL MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let revealPending = false;

document.getElementById('champ-input').addEventListener('keydown', e => {
  if(e.key==='Enter'){
    e.preventDefault();
    if(revealPending){ closeReveal(); return; }
    submitAnswer();
  }
});

function submitAnswer(){
  const val=document.getElementById('champ-input').value.trim();
  if(!val)return;
  document.getElementById('champ-input').value='';

  let matched=null;
  for(const ch of allChampions){
    const r=fuzzyMatch(val,ch.name);
    if(r==='exact'||r==='fuzzy'){matched=ch;break;}
  }

  // Mauvaise r√©ponse ou d√©j√† trouv√© ‚Üí flash rouge, rien d'autre
  if(!matched||foundIds.has(matched.id)){flash('fw');return;}

  // Bonne r√©ponse
  const ev={champId:matched.id,champName:matched.name,playerId:mySocketId||'solo',playerName:myName,ts:Date.now()};
  foundIds.add(matched.id);events.push(ev);
  revealTile(matched.id,myName,true);
  addFeedItem(ev);
  flash('fc');
  updateUI();

  if(mode==='multi'&&socket?.connected)socket.emit('champFound',{champId:matched.id,champName:matched.name});

  // Afficher la modal de r√©v√©lation
  showReveal(matched, myName);

  if(foundIds.size===allChampions.length){
    // Victoire apr√®s fermeture de la modal
    revealPendingVictory=true;
  }
}

let revealPendingVictory=false;

function showReveal(champ, finderName){
  document.getElementById('reveal-img').src=`https://ddragon.leagueoflegends.com/cdn/${version}/img/champion/${champ.id}.png`;
  document.getElementById('reveal-name').textContent=champ.name;
  document.getElementById('reveal-found-by').textContent=mode==='multi'?`‚úì ${finderName}`:'‚úì Trouv√© !';
  document.getElementById('reveal-modal').classList.add('show');
  revealPending=true;
  // focus sur input d√©sactiv√© le temps de la modal
  document.getElementById('champ-input').blur();
}

function closeReveal(){
  document.getElementById('reveal-modal').classList.remove('show');
  revealPending=false;
  if(revealPendingVictory){revealPendingVictory=false;setTimeout(showVictory,300);return;}
  setTimeout(()=>document.getElementById('champ-input').focus(),50);
}

// Clic sur le fond ferme aussi la modal
document.getElementById('reveal-modal').addEventListener('click',function(e){
  if(e.target===this)closeReveal();
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TIMER + VICTORY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function tickTimer(){
  const e=Math.floor((Date.now()-startTime)/1000);
  document.getElementById('timer-disp').textContent=`${String(Math.floor(e/60)).padStart(2,'0')}:${String(e%60).padStart(2,'0')}`;
}
function timeStr(){const e=Math.floor((Date.now()-startTime)/1000);return `${String(Math.floor(e/60)).padStart(2,'0')}:${String(e%60).padStart(2,'0')}`;}
function showVictory(){
  clearInterval(timerIntvl);
  document.getElementById('vic-time').textContent=timeStr();
  const sc={};
  events.forEach(ev=>{if(!sc[ev.playerId])sc[ev.playerId]={name:ev.playerName,n:0};sc[ev.playerId].n++;});
  document.getElementById('scores').innerHTML=Object.values(sc).sort((a,b)=>b.n-a.n).map((s,i)=>
    `<div class="sc-row"><span class="sc-name">${i===0?'üèÜ ':''}${escH(s.name)}</span><span class="sc-pts">${s.n} trouv√©s</span></div>`
  ).join('');
  document.getElementById('victory').classList.add('show');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let flT=null;
function flash(cls){
  const el=document.getElementById('champ-input');
  el.classList.remove('fc','fw');void el.offsetWidth;el.classList.add(cls);
  clearTimeout(flT);flT=setTimeout(()=>el.classList.remove(cls),650);
}
function copyRoomLink(){
  const url=`${location.origin}${location.pathname}#${roomCode}`;
  navigator.clipboard.writeText(url).then(()=>toast('üîó Lien copi√© !')).catch(()=>toast(`Code : ${roomCode}`));
}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),3000);}
function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');}
function hideLoading(){document.getElementById('loading').classList.add('hidden');}
function setErr(m){document.getElementById('lobby-error').textContent=m;}
function escH(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;');}

document.getElementById('player-name').addEventListener('keydown',e=>{if(e.key==='Enter')createRoom();});
document.getElementById('room-code-input').addEventListener('keydown',e=>{if(e.key==='Enter')joinRoom();});
document.getElementById('server-url').addEventListener('keydown',e=>{if(e.key==='Enter')saveServerUrl();});
</script>
</body>
</html>
